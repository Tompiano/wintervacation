# 我实现了的功能和简要的思路

一、注册、登录、忘记密码、添加个人信息、添加用户地址、添加用户头像

1.登录--jwt鉴权登录思路：

1)登录路由：

在用户登录时创建token和fresh_token，并返回给客户端。

2)中间件：

先用token进行检验，如果返回解析失败，可能是token不正确或者token过期，那么再用refresh_token进行检验。这里我假设的是客户端在请求头携带token,
并使用Bearer作为开头。 则检验token是否为空和其头部是否为Bearer（可以用string包获取前面6个字符的方法，也可以用strings包里分成几个部分的方法）。
然后从数据库中获取用户信息，返回给客户端。 且不论是token还是refresh_token，一旦通过验证后即生成新的token和refresh_token，用户可以持续保持登录
状态。

2.添加用户的地址：

这里一个用户可以存多个地址。直接放在单独的地址的表格中。

3.添加用户头像：

先判断用户是否登录。若登录后获取参数file文件（获取的头像图片），userID。

将file保存在本地，将保存后的文件本地路径保存到数据库中的头像对应的表格中。

返回对应的url

4.添加个人信息：

包括用户名、昵称、性别、电话、邮箱、出生日期、userID(作为外键和user表的ID主键关联)

二、创建商品、展示商品、搜索商品、商品详情页的展示

1.创建商品

这里我想是商家可以在平台录入商品的信息，然后服务端再将商品的信息录入数据库。录入前会入参校验，比如商品的名字，简介等的字数和商品是否含有敏感词汇。

2.展示商品

根据

客户端传来的用户想要的商品展示方式，如是根据价格（降序），还是销量（升序），还是评价（升序）。

用户想要展示的种类，呃这里只做了三类商品。 或者是展示全部商品。

前端页面要展示的数据量，根据这些用where,order by,limit来对查找数据库时进行限制。

返回商品的全部信息，包括商品的图片，商品的详细信息

3.搜索商品

这里用了数据库的模糊搜索，我想是搜索出用户包含用户搜索词语的商品，且按照字数匹配度从高到低排序。搜索后也是展示商品的详细信息和图片

4.商品详情页的展示

我看苏宁易购的详情页都是图片，所以这里我就单独建了一张表放商品详情页的图片路径。最后返回商品详情页的URL

三、购物车

1.将商品加入购物车

这里设置的是无论是否登录，均可以加入购物车。加入购物车即视为勾选该商品

未登录时候：先查cookie中是否已经有商品，若有商品，将先前的商品和新加入的商品一起放进cookie中。这期间若有相同产品改变其数量。

已登录时候：仍是先查cookie，若有商品，将先前的商品和新加入的商品一起放进数据库中。若有相同产品就改变其数量即可。

（这里本来想考虑cookie禁用的问题，但是测试出来老有问题，就算了~~）

2.删除购物车中的商品

这里分为全选和部分选择。

部分选择的话我就没考虑减少商品数量的方面了，我直接把获取的商品ID对应的商品全部删除了。

3.将购物车内勾选商品结账

获取用户ID，然后查询他里面所有的勾选了的商品，得到其详细信息。然后再进行查验数据库中的商品是否充足（用product表格里面的数量和购物测cart表格里
面的数量进行对比）， 若充足则计算待结算商品的总金额，然后将商品的信息和总金额返回。 最后减少数据库中数量，这一步还不是最终的结算，但是会先锁定数
据库中的商品， 就是先减少商品，返回勾选的商品的信息，和总金额。

4.改变商品的勾选状态

我就是获取商品的勾选状态，这里的check是int类型，要勾选就是1，不勾选就是0.然后update数据库里的勾选（tinyint类型）那列

四、评论

1.写评论、删除评论

就按照parentID对MySQL增删改查。这里所有的评论建立一张表，后续是根据parentID和commentID和userID进行相关的查找。

3.查看评论

先按照productID查询数据库，将所有的该商品下的评论找出来，用切片将扁平化的数据传到api层。再定义一个新的map用于装树型数据。
用先序遍历，遍历各个数据的parentID。如果parentID=0，就将其直接放入map中，否则将其放入其对应的parent的children里面。
每遍历一个评论，就将其对应的信息放入map中。最后将map用json渲染后返回给客户端。

五、店铺

1.写店铺公告、更新店铺公告

就是建立了张店铺的表格，然后对announcement进行增删改查

2.商品展示

这里与前面的商品展示差不多，只是这里仅仅展示该店铺的商品

3.商品详情页的录入、商品详情页的图片更新

这里做的是商家的一个后台管理系统，苏宁的商品详情页都是图片，所以就跟之前的头像图片录入差不多。

六、收藏夹

1.加入收藏夹

就是将productID、userID加入收藏表中

2.删除收藏夹中的内容

就是获取productID、userID，然后对数据库进行增删改查

3.查看收藏夹

获取userID,然后根据用户的收藏夹，返回商品的全部信息

七、订单

1.选择收货地址

就是将用户的所有地址返回，供用户选择

2.提交订单

获取用户的支付方式、地址和ID，然后返回订单所包含的商品的所有信息，这里还不知道用户是否已经付了款，但是知道他用什么准备付款。这里设定的是待支付状态

3.订单状态显示（已支付和已收货）

我这两个写的差不多，就是返回的状态不一样。

先判断是否支付和收货，然后返回订单信息和订单状态